version: '3'
services:
  webserver:
    image: nginx:alpine
    container_name: webserver
    tty: true
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    networks:
      - crime-network
    depends_on:
      - zookeeper
      - kafka
      - crimes-api
      - ui

  zookeeper:
    image: wurstmeister/zookeeper
    container_name: zookeeper
    expose:
      - 2181
    networks:
      - crime-network

  kafka:
    image: wurstmeister/kafka
    container_name: kafka
    expose:
      - 9092
    environment:
      KAFKA_ADVERTISED_HOST_NAME: kafka
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
    depends_on:
      - zookeeper
    networks:
      - crime-network

  crimes-api:
    build: ./crimes-api
    image: crimes-api
    container_name: crimes-api
    expose:
      - 5001
    volumes:
      - ./crimes-api/crimes_api:/code/crimes_api
    environment:
      - SERVICE_TAGS=dev
      - SERVICE_NAME=crime-producer
      - UVICORN_PORT=5001
      - UVICORN_HOST=0.0.0.0
      - UVICORN_ROOT_PATH=/api/v1/
    depends_on:
      - kafka
    networks:
      - crime-network

  ui:
    build: ./ui
    image: ui
    container_name: ui
    expose:
      - 3000
    volumes:
      - ./ui/public:/code/public
      - ./ui/src:/code/src
    environment:
      SERVICE_TAGS: dev
      SERVICE_NAME: ui
    networks:
      - crime-network
    stdin_open: true
    depends_on:
      - crimes-api

networks:
  crime-network:
    driver: bridge
